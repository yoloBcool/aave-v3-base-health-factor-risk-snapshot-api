{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/aave-hf-snapshot.schema.json",
  "title": "AAVE v3 Health Factor Snapshot (Base)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "network",
    "chain_id",
    "address",
    "timestamp",
    "user",
    "totals",
    "collateral",
    "debt",
    "oracles",
    "config",
    "meta"
  ],
  "properties": {
    "network": { "const": "base" },
    "chain_id": { "type": "integer", "const": 8453 },
    "address": { "$ref": "#/$defs/address" },
    "timestamp": { "type": "integer", "minimum": 0 },
    "user": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "health_factor",
        "ltv",
        "liquidation_threshold",
        "liquidation_buffer_usd",
        "available_borrows_usd",
        "risk_class",
        "is_safe",
        "stress_tests"
      ],
      "properties": {
        "health_factor": { "$ref": "#/$defs/decimalString" },
        "ltv": { "$ref": "#/$defs/udecimalString" },
        "liquidation_threshold": { "$ref": "#/$defs/udecimalString" },
        "liquidation_buffer_usd": { "$ref": "#/$defs/decimalString" },
        "available_borrows_usd": { "$ref": "#/$defs/udecimalString" },
        "risk_class": { "type": "string", "enum": ["low", "moderate", "high"] },
        "is_safe": { "type": "boolean" },
        "stress_tests": {
          "type": "object",
          "additionalProperties": false,
          "required": ["hf_minus_1pct", "hf_minus_3pct", "hf_minus_5pct"],
          "properties": {
            "hf_minus_1pct": { "$ref": "#/$defs/decimalString" },
            "hf_minus_3pct": { "$ref": "#/$defs/decimalString" },
            "hf_minus_5pct": { "$ref": "#/$defs/decimalString" }
          }
        }
      }
    },
    "totals": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "total_collateral_usd",
        "total_debt_usd",
        "net_equity_usd",
        "current_leverage_ratio",
        "max_leverage_at_current_hf"
      ],
      "properties": {
        "total_collateral_usd": { "$ref": "#/$defs/udecimalString" },
        "total_debt_usd": { "$ref": "#/$defs/udecimalString" },
        "net_equity_usd": { "$ref": "#/$defs/decimalString" },
        "current_leverage_ratio": { "$ref": "#/$defs/udecimalString" },
        "max_leverage_at_current_hf": { "$ref": "#/$defs/udecimalString" }
      }
    },
    "collateral": {
      "type": "array",
      "items": { "$ref": "#/$defs/collateralItem" }
    },
    "debt": {
      "type": "array",
      "items": { "$ref": "#/$defs/debtItem" }
    },
    "oracles": {
      "type": "object",
      "additionalProperties": false,
      "required": ["base_currency", "assets"],
      "properties": {
        "base_currency": {
          "type": "object",
          "additionalProperties": false,
          "required": ["symbol", "price_usd", "last_update"],
          "properties": {
            "symbol": { "type": "string" },
            "price_usd": { "$ref": "#/$defs/udecimalString" },
            "last_update": { "type": "integer", "minimum": 0 }
          }
        },
        "assets": {
          "type": "array",
          "items": { "$ref": "#/$defs/oracleAsset" }
        }
      }
    },
    "config": {
      "type": "object",
      "additionalProperties": false,
      "required": ["emode", "isolation_mode", "caps"],
      "properties": {
        "emode": {
          "type": "object",
          "additionalProperties": false,
          "required": ["active", "category", "settings"],
          "properties": {
            "active": { "type": "boolean" },
            "category": { "type": ["string", "null"] },
            "settings": { "type": ["object", "null"] }
          }
        },
        "isolation_mode": {
          "type": "object",
          "additionalProperties": false,
          "required": ["active", "debt_ceiling_remaining_usd"],
          "properties": {
            "active": { "type": "boolean" },
            "debt_ceiling_remaining_usd": { "$ref": "#/$defs/udecimalString" }
          }
        },
        "caps": {
          "type": "array",
          "items": { "$ref": "#/$defs/capItem" }
        }
      }
    },
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["data_provider", "oracle_source", "latency_ms", "version"],
      "properties": {
        "data_provider": { "type": "string" },
        "oracle_source": { "type": "string" },
        "latency_ms": { "type": "integer", "minimum": 0 },
        "version": { "type": "string" }
      }
    }
  },
  "$defs": {
    "address": {
      "type": "string",
      "pattern": "^0x[0-9a-fA-F]{40}$"
    },
    "decimalString": {
      "type": "string",
      "pattern": "^-?(?:0|[1-9]\\d*)(?:\\.\\d+)?$"
    },
    "udecimalString": {
      "type": "string",
      "pattern": "^(?:0|[1-9]\\d*)(?:\\.\\d+)?$"
    },
    "token": {
      "type": "object",
      "additionalProperties": false,
      "required": ["symbol", "address", "decimals"],
      "properties": {
        "symbol": { "type": "string" },
        "address": { "$ref": "#/$defs/address" },
        "decimals": { "type": "integer", "minimum": 0, "maximum": 255 }
      }
    },
    "collateralItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "token",
        "amount",
        "amount_usd",
        "price_usd",
        "usage_as_collateral_enabled",
        "reserve_ltv",
        "reserve_liquidation_threshold",
        "reserve_liquidation_bonus",
        "emode_category"
      ],
      "properties": {
        "token": { "$ref": "#/$defs/token" },
        "amount": { "$ref": "#/$defs/udecimalString" },
        "amount_usd": { "$ref": "#/$defs/udecimalString" },
        "price_usd": { "$ref": "#/$defs/udecimalString" },
        "usage_as_collateral_enabled": { "type": "boolean" },
        "reserve_ltv": { "$ref": "#/$defs/udecimalString" },
        "reserve_liquidation_threshold": { "$ref": "#/$defs/udecimalString" },
        "reserve_liquidation_bonus": { "$ref": "#/$defs/udecimalString" },
        "emode_category": { "type": ["string", "null"], "pattern": "^[0-9]+$" }
      }
    },
    "debtItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "token",
        "variable_debt",
        "stable_debt",
        "total_debt_usd",
        "variable_borrow_apy",
        "stable_borrow_apy",
        "reserve_utilization",
        "borrow_cap",
        "borrow_cap_used_percent"
      ],
      "properties": {
        "token": { "$ref": "#/$defs/token" },
        "variable_debt": { "$ref": "#/$defs/udecimalString" },
        "stable_debt": { "$ref": "#/$defs/udecimalString" },
        "total_debt_usd": { "$ref": "#/$defs/udecimalString" },
        "variable_borrow_apy": { "$ref": "#/$defs/udecimalString" },
        "stable_borrow_apy": { "$ref": "#/$defs/udecimalString" },
        "reserve_utilization": { "$ref": "#/$defs/udecimalString" },
        "borrow_cap": {
          "type": "string",
          "pattern": "^(?:0|[1-9]\\d*)$"
        },
        "borrow_cap_used_percent": { "$ref": "#/$defs/udecimalString" }
      }
    },
    "oracleAsset": {
      "type": "object",
      "additionalProperties": false,
      "required": ["token", "price_usd", "last_update", "confidence_score"],
      "properties": {
        "token": { "$ref": "#/$defs/token" },
        "price_usd": { "$ref": "#/$defs/udecimalString" },
        "last_update": { "type": "integer", "minimum": 0 },
        "confidence_score": { "$ref": "#/$defs/udecimalString" }
      }
    },
    "capItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "token",
        "supply_cap",
        "supply_cap_used_percent",
        "borrow_cap",
        "borrow_cap_used_percent"
      ],
      "properties": {
        "token": { "$ref": "#/$defs/token" },
        "supply_cap": { "type": "string", "pattern": "^(?:0|[1-9]\\d*)$" },
        "supply_cap_used_percent": { "$ref": "#/$defs/udecimalString" },
        "borrow_cap": { "type": "string", "pattern": "^(?:0|[1-9]\\d*)$" },
        "borrow_cap_used_percent": { "$ref": "#/$defs/udecimalString" }
      }
    }
  },
  "examples": [
    {
      "network": "base",
      "chain_id": 8453,
      "address": "0x0000000000000000000000000000000000000000",
      "timestamp": 1700000000,
      "user": {
        "health_factor": "1.23",
        "ltv": "0.72",
        "liquidation_threshold": "0.78",
        "liquidation_buffer_usd": "123.45",
        "available_borrows_usd": "456.78",
        "risk_class": "moderate",
        "is_safe": true,
        "stress_tests": {
          "hf_minus_1pct": "1.21",
          "hf_minus_3pct": "1.18",
          "hf_minus_5pct": "1.17"
        }
      },
      "totals": {
        "total_collateral_usd": "1000.00",
        "total_debt_usd": "600.00",
        "net_equity_usd": "400.00",
        "current_leverage_ratio": "2.50",
        "max_leverage_at_current_hf": "4.00"
      },
      "collateral": [],
      "debt": [],
      "oracles": {
        "base_currency": { "symbol": "ETH", "price_usd": "2000.00", "last_update": 1700000000 },
        "assets": []
      },
      "config": {
        "emode": { "active": false, "category": null, "settings": null },
        "isolation_mode": { "active": false, "debt_ceiling_remaining_usd": "0" },
        "caps": []
      },
      "meta": { "data_provider": "aave-v3", "oracle_source": "aave-oracle", "latency_ms": 10, "version": "1.0.0" }
    }
  ]
}
